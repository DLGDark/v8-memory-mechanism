<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>查看垃圾回收日志 | 揭秘V8内存神秘面纱</title>
    <meta name="description" content="v8-memory-mechanism">
    <link rel="icon" href="/v8-memory-mechanism/content/favicon.ico">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/v8-memory-mechanism/assets/css/0.styles.24131f21.css" as="style"><link rel="preload" href="/v8-memory-mechanism/assets/js/app.f97e74ef.js" as="script"><link rel="preload" href="/v8-memory-mechanism/assets/js/2.086987ff.js" as="script"><link rel="preload" href="/v8-memory-mechanism/assets/js/15.49bd0c91.js" as="script"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/10.98769fd7.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/11.944a39db.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/12.eae54814.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/13.d925417d.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/14.d7495123.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/16.78523aea.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/3.dbef74a1.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/4.b6213a41.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/5.9360fc3d.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/6.8089035a.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/7.618484f5.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/8.3d306d96.js"><link rel="prefetch" href="/v8-memory-mechanism/assets/js/9.faddb988.js">
    <link rel="stylesheet" href="/v8-memory-mechanism/assets/css/0.styles.24131f21.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/v8-memory-mechanism/" class="home-link router-link-active"><!----> <span class="site-name">揭秘V8内存神秘面纱</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/v8-memory-mechanism/start/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/v8-memory-mechanism/furtherReading/" class="nav-link">拓展阅读</a></div><div class="nav-item"><a href="/v8-memory-mechanism/about/" class="nav-link">关于</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/v8-memory-mechanism/start/" class="nav-link router-link-active">正文</a></div><div class="nav-item"><a href="/v8-memory-mechanism/furtherReading/" class="nav-link">拓展阅读</a></div><div class="nav-item"><a href="/v8-memory-mechanism/about/" class="nav-link">关于</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>正文</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/v8-memory-mechanism/start/" class="sidebar-link">历史背景</a></li><li><a href="/v8-memory-mechanism/start/MemoryLimit.html" class="sidebar-link">V8的内存限制</a></li><li><a href="/v8-memory-mechanism/start/ObjectAllocation.html" class="sidebar-link">V8的对象分配</a></li><li><a href="/v8-memory-mechanism/start/GarbageCollection.html" class="sidebar-link">V8的垃圾回收机制</a></li><li><a href="/v8-memory-mechanism/start/ViewGarbageCollectionLog.html" class="active sidebar-link">查看垃圾回收日志</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="查看垃圾回收日志"><a href="#查看垃圾回收日志" class="header-anchor">#</a> 查看垃圾回收日志</h1> <p>查看垃圾回收日志的方式主要是在启动时添加 --trace_gc参数。在进行垃圾回收时，将会从标准输出中打印垃圾回收的日志信息。下面是一段示例，执行结束后，将会在gc.log文件中得到所有垃圾回收信息：</p> <p>node --trace_gc -e &quot;var a = [];for (var i = 0; i &lt; 1000000; i++) a.push(new Array(100));&quot; &gt; gc.log</p> <p>下面是上面命令执行完成后生成的日志文件内容：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>       <span class="token number">39</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">2.5</span> <span class="token punctuation">(</span><span class="token number">4.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2.2</span> <span class="token punctuation">(</span><span class="token number">5.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>       <span class="token number">54</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">2.7</span> <span class="token punctuation">(</span><span class="token number">5.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2.7</span> <span class="token punctuation">(</span><span class="token number">6.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">1.3</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>       <span class="token number">96</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">3.9</span> <span class="token punctuation">(</span><span class="token number">6.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">3.7</span> <span class="token punctuation">(</span><span class="token number">9.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">0.7</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>       <span class="token number">97</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">5.1</span> <span class="token punctuation">(</span><span class="token number">9.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">5.0</span> <span class="token punctuation">(</span><span class="token number">9.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">0.8</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>       <span class="token number">98</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">5.6</span> <span class="token punctuation">(</span><span class="token number">9.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">5.6</span> <span class="token punctuation">(</span><span class="token number">15.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">0.9</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">102</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">8.9</span> <span class="token punctuation">(</span><span class="token number">15.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">8.9</span> <span class="token punctuation">(</span><span class="token number">15.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">1.8</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">104</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">9.5</span> <span class="token punctuation">(</span><span class="token number">15.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">9.3</span> <span class="token punctuation">(</span><span class="token number">27.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">2.3</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">114</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">17.0</span> <span class="token punctuation">(</span><span class="token number">28.7</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">17.1</span> <span class="token punctuation">(</span><span class="token number">28.7</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">4.2</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">119</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">17.5</span> <span class="token punctuation">(</span><span class="token number">28.7</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">17.1</span> <span class="token punctuation">(</span><span class="token number">52.7</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">5.0</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">134</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">32.5</span> <span class="token punctuation">(</span><span class="token number">52.7</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">32.9</span> <span class="token punctuation">(</span><span class="token number">52.7</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">8.3</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">144</span> ms<span class="token punctuation">:</span> Scavenge <span class="token number">32.9</span> <span class="token punctuation">(</span><span class="token number">52.7</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">32.1</span> <span class="token punctuation">(</span><span class="token number">68.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">10.1</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> allocation failure
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">242</span> ms<span class="token punctuation">:</span> Mark<span class="token operator">-</span>sweep <span class="token number">127.2</span> <span class="token punctuation">(</span><span class="token number">162.2</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">124.6</span> <span class="token punctuation">(</span><span class="token number">160.6</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">4.1</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">2.2</span> ms <span class="token keyword">in</span> <span class="token number">15</span> steps since start <span class="token keyword">of</span> marking<span class="token punctuation">,</span> biggest step <span class="token number">0.5</span> ms<span class="token punctuation">,</span> walltime since start <span class="token keyword">of</span> marking <span class="token number">39</span> ms<span class="token punctuation">)</span> <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">1.000</span><span class="token punctuation">)</span> finalize incremental marking via stack guard <span class="token constant">GC</span> <span class="token keyword">in</span> old space requested
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">385</span> ms<span class="token punctuation">:</span> Mark<span class="token operator">-</span>sweep <span class="token number">281.9</span> <span class="token punctuation">(</span><span class="token number">319.6</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">278.5</span> <span class="token punctuation">(</span><span class="token number">318.2</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">2.6</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">24.3</span> ms <span class="token keyword">in</span> <span class="token number">290</span> steps since start <span class="token keyword">of</span> marking<span class="token punctuation">,</span> biggest step <span class="token number">0.8</span> ms<span class="token punctuation">,</span> walltime since start <span class="token keyword">of</span> marking <span class="token number">72</span> ms<span class="token punctuation">)</span> <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">0.814</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">0.814</span><span class="token punctuation">)</span> finalize incremental marking via stack guard <span class="token constant">GC</span> <span class="token keyword">in</span> old space requested
<span class="token punctuation">[</span><span class="token number">8212</span><span class="token punctuation">:</span><span class="token number">00000000003014</span>C0<span class="token punctuation">]</span>      <span class="token number">702</span> ms<span class="token punctuation">:</span> Mark<span class="token operator">-</span>sweep <span class="token number">612.5</span> <span class="token punctuation">(</span><span class="token number">658.4</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">605.1</span> <span class="token punctuation">(</span><span class="token number">650.9</span><span class="token punctuation">)</span> <span class="token constant">MB</span><span class="token punctuation">,</span> <span class="token number">1.8</span> <span class="token operator">/</span> <span class="token number">0.0</span> <span class="token function">ms</span>  <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">67.6</span> ms <span class="token keyword">in</span> <span class="token number">660</span> steps since start <span class="token keyword">of</span> marking<span class="token punctuation">,</span> biggest step <span class="token number">1.5</span> ms<span class="token punctuation">,</span> walltime since start <span class="token keyword">of</span> marking <span class="token number">166</span> ms<span class="token punctuation">)</span> <span class="token punctuation">(</span>average mu <span class="token operator">=</span> <span class="token number">0.792</span><span class="token punctuation">,</span> current mu <span class="token operator">=</span> <span class="token number">0.783</span><span class="token punctuation">)</span> finalize incremental marking via stack guard <span class="token constant">GC</span> <span class="token keyword">in</span> old space requested
</code></pre></div><p>通过分析垃圾回收日志，可以了解垃圾回收的运行情况，找出垃圾回收的哪些阶段比较耗时，触发的原因是什么。</p> <p>通过在Node启动时使用 --prof参数，可以得到V8执行时的性能分析数据，其中包含了垃圾回收执行时占用的时间。下面的代码不断创建对象并将其分配给局部变量a，这里将以下代码存为 test.js文件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">1000000</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> a<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后执行以下命令：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>node <span class="token operator">--</span>prof test<span class="token punctuation">.</span>js
</code></pre></div><p>这将会在目录下得到一个V8.log日志文件。内容大致如下(内容过多，只截取了部分内容)：</p> <p><img src="/v8-memory-mechanism/content/v8log.png" alt="v8log"></p> <p>V8提供了linux-tick-processor工具用于统计日志信息。该工具可以从此链接找到 <a href="https://github.com/v8/v8/tree/master/tools" target="_blank" rel="noopener noreferrer">linux-tick-processor工具<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>在linux系统下使用工具命令如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>linux<span class="token operator">-</span>tick<span class="token operator">-</span>processor v8<span class="token punctuation">.</span>log
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/v8-memory-mechanism/start/GarbageCollection.html" class="prev">V8的垃圾回收机制</a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/v8-memory-mechanism/assets/js/app.f97e74ef.js" defer></script><script src="/v8-memory-mechanism/assets/js/2.086987ff.js" defer></script><script src="/v8-memory-mechanism/assets/js/15.49bd0c91.js" defer></script>
  </body>
</html>
